# Incident Report: Pizza Factory Service Outage

**Date:** December 2, 2025
**Status:** Resolved

## Summary
On December 2, 2025, between 10:10 AM and 10:22 AM, the JWT Pizza Service experienced a partial outage affecting the order creation workflow. During this 12-minute window, the third-party Pizza Factory API became unavailable, causing 100% of pizza orders to fail. The issue was identified as a scheduled chaos testing event that shut down the upstream factory service. The incident resolved itself when the factory service automatically restarted, and order processing resumed without manual intervention.

## Detection
The incident was detected via automated alerting configured in Grafana.
* **Trigger:** The "Pizza Factory Success Rate %" alert rule triggered when the success rate of outbound requests dropped from 100% to 0%.
* **Notification:** The alert entered the "Pending" state at 10:10:30 and escalated to "Alerting" at 10:11:30, sending a notification to the on-call engineer.
* **Logs:** Evaluation of the Grafana Loki log stream showed `500 Internal Server Error` responses coming from the `pizza-factory.cs329.click` endpoint.

## Impact
* **Affected Services:** The `/api/order` endpoint was fully non-functional. Users could browse the menu and login, but could not complete a purchase.
* **User Impact:** 100% of users attempting to place an order during the 12-minute window received a `500 Failed to fulfill order at factory` error message.
* **Business Impact:** Zero pizzas were sold during the outage window, resulting in a temporary loss of revenue.

## Timeline
* **10:10:30** - "Pizza Factory Success Rate %" metric drops to 0%. Alert state changes from Normal to **Pending**.
* **10:11:30** - Pending threshold exceeded. Alert state changes to **Alerting**. On-call engineer notified.
* **10:12:00** - Engineer began investigation. Grafana "Live Log Stream" confirmed outbound requests to the Pizza Factory were returning status code `500`.
* **10:15:00** - Verified via the report link contained in the error response that the factory was undergoing chaos testing/shutdown.
* **10:22:30** - Pizza Factory service recovered. Grafana metrics showed success rate returning to 100%. Alert state resolved to **Normal**.

## Root Cause Analysis
The immediate cause of the failure was an HTTP `500` error returned by the upstream dependency `https://pizza-factory.cs329.click`.

The underlying cause was a scheduled chaos testing event intended to simulate a complete outage of the factory backend. The JWT Pizza Service correctly handled the error by catching the upstream failure, logging it as a warning, and returning a structured error response to the client. However, because the service relies synchronously on the factory to finalize orders, the upstream outage resulted in a total inability to process sales.

## Resolution
The incident was resolved when the third-party Pizza Factory service completed its chaos routine and came back online. No code changes or configuration updates were required to restore service. The resolution was verified by observing the "Pizza Factory Success Rate" metric return to 100% and confirming that the alert resolved in Grafana.

## Prevention
While we cannot prevent the third-party factory from going offline, we can improve the resilience and user experience of our service during future outages:
1.  **Circuit Breaker:** Implement a circuit breaker pattern for the factory API calls. This would stop the application from hammering a dead service and allow for a "fail fast" mechanism.
2.  **Graceful Degradation:** Investigate if orders can be queued locally and processed asynchronously once the factory returns, rather than failing the user's request immediately.

## Action Items
1.  **[High]** Update the user-facing error message to be more descriptive (e.g., "The kitchen is currently closed") rather than a generic 500 error when the upstream dependency fails.
2.  **[Medium]** Research implementing a retry mechanism with exponential backoff for 500-level errors from the factory, in case of momentary blips.
3.  **[Low]** Add a dashboard annotation in Grafana to mark this time period as a known chaos testing event for historical accuracy.